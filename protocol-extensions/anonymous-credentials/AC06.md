# AC-06: Bootstrap Requests

Bootstrap requests let wallets obtain initial zero-amount Notes without providing inputs. Each Output must be accompanied by a proof that its amount is exactly zero. The Mint issues MACs for such Outputs and returns IssuanceProofs. No inputs, no MacProofs, no RangeProof, and no BalanceProof are used in this flow.

## 1. Endpoint

- Method: POST
- Path: `/v1/kvac/bootstrap`
- Content-Type: application/json

The Mint MAY enforce request limits or anti-spam measures but MUST NOT require inputs for this endpoint.

## 2. Request

The client sends a `BootstrapRequest`:

```json
{
  "outputs": [<Output>, ...],
  "bootstrap_proofs": [<cashu_kvac::models::ZKP>, ...]
}
```

Where:

- `outputs` are `Output`s as defined in [AC-00][AC-00].
- `bootstrap_proofs` contains one `BootstrapProof` per output (serialized `cashu_kvac::ZKP`), proving the corresponding outputâ€™s amount is exactly zero.

```rust
let bootstrap_proof = BootstrapProof::create(&bootstrap_attr, client_transcript.as_mut());
```

Constraints:

- `outputs.len() > 0`
- `outputs.len() == bootstrap_proofs.len()`
- Each `outputs[i].id` MUST correspond to an active keyset (see [AC-01][AC-01] and [AC-02][AC-02]).
- Wallets SHOULD avoid duplicate `tag`s within the same request.

## 3. Mint verification

Upon receiving a `BootstrapRequest`, the Mint performs the following:

1) Pre-flight checks

- Ensure `outputs` is non-empty and lengths match `bootstrap_proofs`.
- Ensure each `outputs[i].id` refers to an active keyset.

2) Initialize transcript

```rust
let mut transcript = cashu_kvac::transcript::CashuTranscript::new();
```

3) Verify zero-amount per output

For each index i:

```rust
let ok = cashu_kvac::kvac::BootstrapProof::verify(
    &outputs[i].commitments.0, // amount commitment
    bootstrap_proofs[i].clone(),
    &mut transcript,
);
if !ok { /* reject */ }
```

The Mint MUST reject the request if any proof fails. There are no inputs, no `MacProof`s, and no balance/range proofs in this flow.

4) Issue MACs and IssuanceProofs

For each valid `output`:

```rust
let mac = cashu_kvac::models::MAC::generate(
    &mint_privkeys[output.id],
    &output.commitments.0,
    Some(&output.commitments.1),
    Some(output.tag),
);

let issuance_proof = cashu_kvac::kvac::IssuanceProof::create(
    &mint_privkeys[output.id],
    output.tag,
    mac,
    output.commitments.0,
    Some(output.commitments.1),
);
```

Note: Issuance proof generation does not use the transcript.

## 4. Response

The Mint responds with `BootstrapResponse`, identical in structure to `SwapResponse` from [AC-03][AC-03]:

```json
{
  "outputs": [<Output>, ...],
  "issued_macs": [<hex-pubkey>, ...],
  "issuance_proofs": [<cashu_kvac::models::ZKP>, ...]
}
```

- `outputs` are echoed back for convenience (aligns with [AC-03][AC-03]).
- `issued_macs[i]` and `issuance_proofs[i]` correspond to `outputs[i]`.

## 5. Client verification and Note assembly

For each (`UnsignedNote`, `MAC`, `IssuanceProof`) triple:

```rust
cashu_kvac::kvac::IssuanceProof::verify(
    &mint_pubkey,                    // derived from outputs[i].id via AC-01/02
    unsigned_note.tag,
    mac,
    &unsigned_note.attributes.0,     // amount attribute
    Some(&unsigned_note.attributes.1), // script attribute
    issuance_proof.clone(),
);
```

If verification succeeds, the wallet combines `UnsignedNote` with `MAC` and `IssuanceProof` to form a `Note` (see [AC-00][AC-00]).

## 6. Errors

- 400 Bad Request
  - Empty `outputs`
  - Length mismatch (`outputs` vs `bootstrap_proofs`)
  - Malformed data or proof encoding
- 422 Unprocessable Entity
  - Inactive/unknown keyset id
  - Invalid `BootstrapProof` (any output fails zero-amount proof)
- 429 Too Many Requests
  - Rate-limited by Mint policy
- 5xx Internal Server Error
  - Unexpected server-side failures

## 7. Security and policy notes

- Each output must individually prove zero amount; RangeProof and BalanceProof are not used in bootstrap.
- The Mint MAY apply rate limits or other DoS mitigations.
- Keyset rotation: wallets SHOULD fetch active keysets via [AC-01][AC-01]/[AC-02][AC-02] prior to bootstrap.

[AC-00]: AC00.md
[AC-01]: AC01.md
[AC-02]: AC02.md
[AC-03]: AC03.md
