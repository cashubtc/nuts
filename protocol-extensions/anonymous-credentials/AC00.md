# AC-00: Introduction and Core Models

`mandatory`

---

This document details the notation and models used throughout the specification. [cashu-kvac][KVAC] is herein referenced as a black-box implementation of the cryptographic operations for Anonymous Credentials, so this specification **WON'T** delve into the mathematic details of the KVAC scheme.

## Terminology Differences

Here are some differences in terminology with respect to the main specifications:

* *proof* $\rightarrow$ *note*: *proof* assumes a different meaning in this context (Zero Knowledge Proofs) so in order to avoid equivocation, the term *note* will be used in its place.

* *Mint* is written with a capital `M`, avoiding equivocation with the verb *to mint*.

* At times, `cashu_kvac::{Struct}` will be used inside JSON code-blocks. This is to abstract away structured types that are fundamental components of the cryptogaphic scheme, but of no interest for the scope of this specification.

## Mint Keys

### Private Key
The Mint's *signing* private key (`MintPrivateKey`), which will be used to issue notes:

> [!NOTE]
> `Scalar::random()` is not a deterministic. In practice, use a deterministic derivation to generate secrets.

```rust
let scalars = (0..6).map(|_| cashu_kvac::Scalar::random()).collect();
let mint_privkey = cashu_kvac::MintPrivateKey::from_scalars(&scalars).unwrap();
```

### Public Key
The Mint's *signing* public key (`MintPublicKey`), which can be used to verify notes client-side:
```rust
let mint_pubkey: cashu_kvac::MintPublicKey = mint_privkey.public_key.clone();
```

## Unsigned Note
An `UnsignedNote` is a note created by the client and yet to be signed by the Mint:
```json
{
    "keyset_id": string,
    "amount": number,
    "script": string,
    "unit": string,
    "tag": 64-char-hex,
    "attributes": [cashu_kvac::AmountAttribute, cashu_kvac::ScriptAttribute],
}
```

where:
* `keyset_id` is the ID of the keyset that will sign this note (see [AC-02][AC-02])
* `amount` is the amount this note represents
* (optional) `script` is a [NUT-10](10) spending condition
* `unit` is the unit of the note (e.g. "sat", "msat", "usd")
* `tag` is a unique identifier for this note, chosen by the client.
* `attributes` is a tuple containing a `AmountAttribute` and a `ScriptAttribute`. These can be created by the client with:
```rust
let blinding_factor_amount = "deadbeefdeadbeefdeadbeefdeadbeef";
let blinding_factor_script = "baadc0debaadc0debaadc0debaadc0de";

let amount_attr = cashu_kvac::AmountAttribute::new(1337, Some(blinding_factor_amount));

/* No spending conditions */
let script_attr = cashu_kvac::ScriptAttribute::new(b"", Some(blinding_factor_script));
```

## Output
`Output` is -as the name suggests- an output of a transaction and it holds all of the information a Mint is allowed to see of a `UnsignedNote`:
```json
{
    "id": <string>,
    "tag": <64-char-hex>,
    "commitments": <[66-char-hex, 66-char-hex]>,
}
```

where:
* `id` is `unsigned_note.keyset_id`
* `tag` is `unsigned_note.tag`
* `commitments` is a tuple containing the commiments from the original attributes, namely: 
  * `unsigned_note.attributes.0.commitment()`
  * `unsigned_note.attributes.1.commitment()`.

## MAC
A `MAC` (Message Authentication Code) is the signature the Mint can issue on `Output`, using `MintPrivateKey`:

```rust
let mac = MAC::generate(
    &mint_privkey,
    &output.commitments.0,
    Some(&output.commitments.1),
    Some(output.tag),
)
```

## Note

A `Note` (or *signed note*) is a note that has received a `MAC` from the Mint.

```json
{
    "keyset_id": <string>,
    "amount": <number>,
    "script": <string>,
    "unit": <string>,
    "tag": <64-char-hex>,
    "mac": <66-char-hex>,
    "attributes": [<cashu_kvac::AmountAttribute>, <cashu_kvac::ScriptAttribute>],
    "issuance_proof": <cashu_kvac::ZKP>
}
```
where:
* `keyset_id`, `amount`, `script`, `unit` `attributes` and `tag` are the same as in `UnsignedNote`.
* `mac` is the signature value returned by the Mint
* `issuance_proof` is a Zero-Knowledge Proof returned by the Mint that confirms `MAC` was issued using `MintPublicKey`.

## Input

`Input` is an input to a transaction and holds all of the information a Mint is allowed to see of a `Note`. It's derived from `Note` as the following:

```json
{
    "id": <string>,
    "script": <string>,
    "randomized_commitments": <cashu_kvac::RandomizedCommitments>,
    "witness": <string>
}
```

where:
* `id` is `note.keyset_id`.
* (optional) `script` is the serialized [NUT-10][10] spending condition associated with this note (`note.script`).
* (optional) `witness` is the serialized [NUT-10][10] witness that unlocks the specific spending condition in `script`.
* `randomized_commitments` are derived from `note.tag`, `note.mac` and `note.attributes` as the following:
```rust
    let randomized_commitments = cashu_kvac::RandomizedCommitments::from_attributes_and_mac(
        &note.attributes.0,
        Some(&note.attributes.1),
        note.tag,
        note.mac,
    true);
```

## Identifiers

### Mint

The Mint identifies transaction `Input`s by their `Cv` randomized commitment (`input.randomized_commitments.Cv`).

The Mint identifies transaction `Output`s by their `tag` (`output.tag`)

### Clients

Clients can identify both `Note` and `UnsignedNote` by their `tag` (`{unsigned_note|note}.tag`).

[KVAC]: https://github.com/lollerfirst/cashu-kvac.git
[10]: 10.md
[13]: 13.md
[AC-02]: AC02.md