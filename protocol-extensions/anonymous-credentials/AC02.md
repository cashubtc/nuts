# AC-02: Keysets and Fees

`mandatory`

---
```
Status: Stable draft
Scope: Listing all keysets and their fee policy
Dependencies: AC-00, AC-01, NUT-02
```

KVAC keysets largely follow NUT-02. This document specifies the endpoint and wire format for retrieving all keysets and fee parameters used by Anonymous Credentials extensions.

## 1. Endpoint

- GET `/v1/kvac/keysets`
- Content-Type: application/json

## 2. Response

```json
{
  "keysets": [
    {
      "id": "<hex>",
      "unit": "<str>",
      "active": true,
      "final_expiry": "<int|null>",
      "input_fee_ppk": "<int|null>"
    }
  ]
}
```

Field semantics:
- `id`: keyset identifier recomputable from public keys (see NUT-02).
- `unit`: currency unit string for this keyset.
- `active`: whether the Mint will sign new Outputs for this keyset.
- `final_expiry`: optional Unix epoch after which the keyset may be permanently deleted.
- `input_fee_ppk`: optional per-thousand fee applied per input in swap flows. If omitted, treated as 0.

Constraints:
- Clients **MUST** treat `active=false` keysets as valid for Inputs but NOT for new Outputs.
- Fee calculation: input dependant fees as defined in [NUT-02](02) §3.6.

## 3. Client Behavior

- SHOULD fetch `/v1/kvac/keysets` periodically to handle rotation and fee changes.
- MUST ensure Outputs reference active keysets only.
- SHOULD align units within a single request (see AC-00/AC-03).

## 4. Errors

- 5xx — server-side failures

## 5. Security and Policy Notes

- Keyset rotation and expiries can invalidate issuance; wallets SHOULD re-fetch before constructing requests that include Outputs.
- Fee policy changes are Mint-defined; clients SHOULD not assume stability without refresh.

[AC-00]: AC00.md
[AC-03]: AC03.md
[02]: 02.md
