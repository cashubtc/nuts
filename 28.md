# NUT-28: Mint Quote Lookup by Public Key

`optional`

`depends on: NUT-04, NUT-20`

---

This NUT adds an endpoint for users to query mint quotes associated with their public key. This enables third-party mint quotes where one user creates and pays a quote for another user to redeem.

> [!NOTE]
>
> Quote creation with a public key and minting with a signature are defined in [NUT-20][20]. This NUT only adds the ability to discover quotes by public key.

## Use cases

- **Mining pools**: A pool creates paid quotes for miners' public keys when shares are validated
- **Gift payments**: `Alice` pays for `Bob` to receive ecash without `Bob` initiating a request

## Querying quotes by public key

To query quotes assigned to a public key, the wallet makes a `POST /v1/mint/quote/{method}/pubkey` request.

```http
POST https://mint.host:3338/v1/mint/quote/bolt11/pubkey
```

The wallet includes the following `PostMintQuotesByPubkeyRequest` data:

```json
{
  "pubkey": <str>,
  "timestamp": <int>,
  "signature": <str>,
  "unit": <str|null>,
  "state": <str|null>
}
```

| Field | Type | Description |
| --- | --- | --- |
| `pubkey` | `str` | Compressed secp256k1 public key (33 bytes, hex-encoded) |
| `timestamp` | `int` | Unix timestamp (provides entropy for signature) |
| `signature` | `str` | BIP340 Schnorr signature (see below) |
| `unit` | `str\|null` | Optional filter by currency unit |
| `state` | `str\|null` | Optional filter by quote state |

### Signature scheme

The message to sign is:

```
msg_to_sign = "quote_lookup" || pubkey || timestamp || unit || state
```

Where `||` denotes concatenation. All fields are UTF-8 strings. If `unit` or `state` is null, use an empty string.

The signature is a [BIP340](https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki) Schnorr signature on `SHA256(msg_to_sign)`.

### Response

The mint responds with a `PostMintQuotesByPubkeyResponse`:

```json
{
  "quotes": <Array[MintQuoteResponse]>
}
```

Where `MintQuoteResponse` is the quote response type defined in [NUT-04][04].

## Errors

See [Error Codes][errors]:

- `20010`: Signature for quote lookup invalid

## Settings

The settings for this NUT are part of the mint info response ([NUT-06][06]):

```json
{
  "28": {
    "supported": <bool>
  }
}
```

[04]: 04.md
[06]: 06.md
[20]: 20.md
[errors]: error_codes.md
